<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Blockchain Voting DApp</title>
<style>
     body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      text-align: center;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }

    .app {
      max-width: 600px;
      margin: auto;
      padding: 20px;
      background: white;
      border-radius: 12px;
      box-shadow: 0px 4px 10px rgba(0,0,0,0.1);
      transition: background 0.3s, color 0.3s;
    }

    h1 {
      color: #333;
    }

    button {
      padding: 10px 20px;
      margin: 10px;
      cursor: pointer;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 8px;
      transition: 0.3s;
    }

    button:hover {
      background: #0056b3;
    }

    input {
      padding: 10px;
      margin: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
    }

    #candidates p, #status, #voteStatus, #winner {
      background: #f0f0f0;
      padding: 8px;
      border-radius: 6px;
      margin: 5px 0;
    }

    /* Dark Mode */
    body.dark {
      background: #121212;
      color: #f5f5f5;
    }

    body.dark .app {
      background: #1e1e1e;
      color: #f5f5f5;
    }

    body.dark #candidates p,
    body.dark #status,
    body.dark #voteStatus,
    body.dark #winner {
      background: #2a2a2a;
    }

    .switch {
      position: absolute;
      top: 20px;
      right: 20px;
      cursor: pointer;
      background: #333;
      color: white;
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 14px;
      transition: 0.3s;
    }

    .switch:hover {
      background: #555;
    }
</style>   
</head>
<body>
  <button class="switch" onclick="toggleDarkMode()">ðŸŒ™ Dark Mode</button>

  <div class="app">
    <h1><i class="fa-solid fa-vote-yea"></i> Blockchain Voting System</h1>

    <!-- Wallet Connect -->
    <button id="connectWallet">Connect Wallet</button>
    <p id="walletAddress">Not connected</p>

    <!-- Candidate List -->
    <h2>Candidates</h2>
    <div id="candidates">
      <p><b>ID:</b> 1 | <b>Name:</b> Alice | <b>Party:</b> ABC | <b>Votes:</b> 5</p>
      <p><b>ID:</b> 2 | <b>Name:</b> Bob | <b>Party:</b> XYZ | <b>Votes:</b> 3</p>
    </div>

    <!-- Voting -->
    <h2>Cast Your Vote</h2>
    <input type="number" id="voterId" placeholder="Enter Voter ID">
    <input type="number" id="candidateId" placeholder="Enter Candidate ID">
    <button id="voteBtn">Vote</button>
    <p id="voteStatus">Waiting...</p>

    <!-- Election Status -->
    <h2>Election Info</h2>
    <button id="statusBtn">Get Voting Status</button>
    <p id="status">Voting Status: Not Started</p>

    <!-- Results -->
    <h2>Election Results</h2>
    <button id="resultBtn">Get Winner</button>
    <p id="winner">Winner Address: -</p>
  </div>
  <script>
    function toggleDarkMode(){
      document.body.classList.toggle("dark");
      const btn = document.querySelector(".switch");
      if(document.body.classList.contains("dark")){
        btn.textContent = "â˜€ï¸ Light Mode";
      } else {
        btn.textContent = "ðŸŒ™ Dark Mode";
      }
    }
  // Your contract ABI
  const contractABI = [
    [
	{
		"inputs": [],
		"name": "announceVotingResult",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_voterId",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_candidateId",
				"type": "uint256"
			}
		],
		"name": "castVote",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "emergencyStopVotin",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "string",
				"name": "_party",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_age",
				"type": "uint256"
			},
			{
				"internalType": "enum Vote.Gender",
				"name": "_gender",
				"type": "uint8"
			}
		],
		"name": "registerCandidate",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_name",
				"type": "string"
			},
			{
				"internalType": "uint256",
				"name": "_age",
				"type": "uint256"
			},
			{
				"internalType": "enum Vote.Gender",
				"name": "_gender",
				"type": "uint8"
			}
		],
		"name": "registerVoter",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "uint256",
				"name": "_startTimeDuration",
				"type": "uint256"
			},
			{
				"internalType": "uint256",
				"name": "_endTimeDuration",
				"type": "uint256"
			}
		],
		"name": "setVotingPeriod",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"inputs": [],
		"stateMutability": "nonpayable",
		"type": "constructor"
	},
	{
		"inputs": [],
		"name": "electionCommission",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getCandidateList",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "string",
						"name": "party",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "age",
						"type": "uint256"
					},
					{
						"internalType": "enum Vote.Gender",
						"name": "gender",
						"type": "uint8"
					},
					{
						"internalType": "uint256",
						"name": "candidateId",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "candidateAddress",
						"type": "address"
					},
					{
						"internalType": "uint256",
						"name": "votes",
						"type": "uint256"
					}
				],
				"internalType": "struct Vote.Candidate[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getVoterList",
		"outputs": [
			{
				"components": [
					{
						"internalType": "string",
						"name": "name",
						"type": "string"
					},
					{
						"internalType": "uint256",
						"name": "age",
						"type": "uint256"
					},
					{
						"internalType": "uint256",
						"name": "voterId",
						"type": "uint256"
					},
					{
						"internalType": "enum Vote.Gender",
						"name": "gender",
						"type": "uint8"
					},
					{
						"internalType": "uint256",
						"name": "voterCandidateId",
						"type": "uint256"
					},
					{
						"internalType": "address",
						"name": "voterAddress",
						"type": "address"
					}
				],
				"internalType": "struct Vote.Voter[]",
				"name": "",
				"type": "tuple[]"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "getVotingStatus",
		"outputs": [
			{
				"internalType": "enum Vote.VotingStatus",
				"name": "",
				"type": "uint8"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [],
		"name": "winner",
		"outputs": [
			{
				"internalType": "address",
				"name": "",
				"type": "address"
			}
		],
		"stateMutability": "view",
		"type": "function"
	}
]
  ];

  // Your deployed contract address
  const contractAddress = "0xd9145CCE52D386f254917e481eB44e9943F39138";

  let contract;
  let signer;

  // Connect wallet
  document.getElementById("connectWallet").onclick = async () => {
    if (window.ethereum) {
      await window.ethereum.request({ method: "eth_requestAccounts" });
      const provider = new ethers.providers.Web3Provider(window.ethereum);
      signer = provider.getSigner();
      contract = new ethers.Contract(contractAddress, contractABI, signer);

      const address = await signer.getAddress();
      document.getElementById("walletAddress").textContent = "Connected: " + address;
    } else {
      alert("MetaMask not found. Please install it.");
    }
  };

  // Cast Vote
  document.getElementById("voteBtn").onclick = async () => {
    const voterId = document.getElementById("voterId").value;
    const candidateId = document.getElementById("candidateId").value;

    try {
      const tx = await contract.vote(voterId, candidateId);
      await tx.wait();
      document.getElementById("voteStatus").textContent = "âœ… Vote Cast Successfully!";
    } catch (err) {
      console.error(err);
      document.getElementById("voteStatus").textContent = "âŒ Error casting vote!";
    }
  };

  // Get Voting Status
  document.getElementById("statusBtn").onclick = async () => {
    try {
      const status = await contract.getVotingStatus();
      document.getElementById("status").textContent = "Voting Status: " + status;
    } catch (err) {
      console.error(err);
    }
  };

  // Get Winner
  document.getElementById("resultBtn").onclick = async () => {
    try {
      const winner = await contract.getWinner();
      document.getElementById("winner").textContent = "Winner Address: " + winner;
    } catch (err) {
      console.error(err);
    }
  };
</script>
</body>
</html>